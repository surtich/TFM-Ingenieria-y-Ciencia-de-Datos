% Options for packages loaded elsewhere
\PassOptionsToPackage{unicode}{hyperref}
\PassOptionsToPackage{hyphens}{url}
\PassOptionsToPackage{dvipsnames,svgnames,x11names}{xcolor}
%
\documentclass[
  12pt,
  a4paper,
  extrafontsizes,
  onecolumn,
  openright]{memoir}

\usepackage{amsmath,amssymb}
\usepackage{iftex}
\ifPDFTeX
  \usepackage[T1]{fontenc}
  \usepackage[utf8]{inputenc}
  \usepackage{textcomp} % provide euro and other symbols
\else % if luatex or xetex
  \usepackage{unicode-math}
  \defaultfontfeatures{Scale=MatchLowercase}
  \defaultfontfeatures[\rmfamily]{Ligatures=TeX,Scale=1}
\fi
\usepackage{lmodern}
\ifPDFTeX\else  
    % xetex/luatex font selection
  \setmainfont[Extension=.otf,UprightFont=*-regular,BoldFont=*-bold,BoldItalicFont=*-bolditalic,ItalicFont=*-italic]{texgyretermes}
  \setmathfont[]{texgyretermes-math.otf}
\fi
% Use upquote if available, for straight quotes in verbatim environments
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
\IfFileExists{microtype.sty}{% use microtype if available
  \usepackage[]{microtype}
  \UseMicrotypeSet[protrusion]{basicmath} % disable protrusion for tt fonts
}{}
\makeatletter
\@ifundefined{KOMAClassName}{% if non-KOMA class
  \IfFileExists{parskip.sty}{%
    \usepackage{parskip}
  }{% else
    \setlength{\parindent}{0pt}
    \setlength{\parskip}{6pt plus 2pt minus 1pt}}
}{% if KOMA class
  \KOMAoptions{parskip=half}}
\makeatother
\usepackage{xcolor}
\setlength{\emergencystretch}{3em} % prevent overfull lines
\setcounter{secnumdepth}{5}
% Make \paragraph and \subparagraph free-standing
\ifx\paragraph\undefined\else
  \let\oldparagraph\paragraph
  \renewcommand{\paragraph}[1]{\oldparagraph{#1}\mbox{}}
\fi
\ifx\subparagraph\undefined\else
  \let\oldsubparagraph\subparagraph
  \renewcommand{\subparagraph}[1]{\oldsubparagraph{#1}\mbox{}}
\fi
% pandoc tempate
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\usepackage{color}
\usepackage{fancyvrb}
\newcommand{\VerbBar}{|}
\newcommand{\VERB}{\Verb[commandchars=\\\{\}]}
\DefineVerbatimEnvironment{Highlighting}{Verbatim}{commandchars=\\\{\}}
% Add ',fontsize=\small' for more characters per line
\usepackage{framed}
\definecolor{shadecolor}{RGB}{241,243,245}
\newenvironment{Shaded}{\begin{snugshade}}{\end{snugshade}}
\newcommand{\AlertTok}[1]{\textcolor[rgb]{0.68,0.00,0.00}{#1}}
\newcommand{\AnnotationTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{#1}}
\newcommand{\AttributeTok}[1]{\textcolor[rgb]{0.40,0.45,0.13}{#1}}
\newcommand{\BaseNTok}[1]{\textcolor[rgb]{0.68,0.00,0.00}{#1}}
\newcommand{\BuiltInTok}[1]{\textcolor[rgb]{0.00,0.23,0.31}{#1}}
\newcommand{\CharTok}[1]{\textcolor[rgb]{0.13,0.47,0.30}{#1}}
\newcommand{\CommentTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{#1}}
\newcommand{\CommentVarTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{\textit{#1}}}
\newcommand{\ConstantTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{#1}}
\newcommand{\ControlFlowTok}[1]{\textcolor[rgb]{0.00,0.23,0.31}{#1}}
\newcommand{\DataTypeTok}[1]{\textcolor[rgb]{0.68,0.00,0.00}{#1}}
\newcommand{\DecValTok}[1]{\textcolor[rgb]{0.68,0.00,0.00}{#1}}
\newcommand{\DocumentationTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{\textit{#1}}}
\newcommand{\ErrorTok}[1]{\textcolor[rgb]{0.68,0.00,0.00}{#1}}
\newcommand{\ExtensionTok}[1]{\textcolor[rgb]{0.00,0.23,0.31}{#1}}
\newcommand{\FloatTok}[1]{\textcolor[rgb]{0.68,0.00,0.00}{#1}}
\newcommand{\FunctionTok}[1]{\textcolor[rgb]{0.28,0.35,0.67}{#1}}
\newcommand{\ImportTok}[1]{\textcolor[rgb]{0.00,0.46,0.62}{#1}}
\newcommand{\InformationTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{#1}}
\newcommand{\KeywordTok}[1]{\textcolor[rgb]{0.00,0.23,0.31}{#1}}
\newcommand{\NormalTok}[1]{\textcolor[rgb]{0.00,0.23,0.31}{#1}}
\newcommand{\OperatorTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{#1}}
\newcommand{\OtherTok}[1]{\textcolor[rgb]{0.00,0.23,0.31}{#1}}
\newcommand{\PreprocessorTok}[1]{\textcolor[rgb]{0.68,0.00,0.00}{#1}}
\newcommand{\RegionMarkerTok}[1]{\textcolor[rgb]{0.00,0.23,0.31}{#1}}
\newcommand{\SpecialCharTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{#1}}
\newcommand{\SpecialStringTok}[1]{\textcolor[rgb]{0.13,0.47,0.30}{#1}}
\newcommand{\StringTok}[1]{\textcolor[rgb]{0.13,0.47,0.30}{#1}}
\newcommand{\VariableTok}[1]{\textcolor[rgb]{0.07,0.07,0.07}{#1}}
\newcommand{\VerbatimStringTok}[1]{\textcolor[rgb]{0.13,0.47,0.30}{#1}}
\newcommand{\WarningTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{\textit{#1}}}

\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}\usepackage{longtable,booktabs,array}
\usepackage{calc} % for calculating minipage widths
% Correct order of tables after \paragraph or \subparagraph
\usepackage{etoolbox}
\makeatletter
\patchcmd\longtable{\par}{\if@noskipsec\mbox{}\fi\par}{}{}
\makeatother
% Allow footnotes in longtable head/foot
\IfFileExists{footnotehyper.sty}{\usepackage{footnotehyper}}{\usepackage{footnote}}
\makesavenoteenv{longtable}
\usepackage{graphicx}
\makeatletter
\def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth\else\Gin@nat@width\fi}
\def\maxheight{\ifdim\Gin@nat@height>\textheight\textheight\else\Gin@nat@height\fi}
\makeatother
% Scale images if necessary, so that they will not overflow the page
% margins by default, and it is still possible to overwrite the defaults
% using explicit options in \includegraphics[width, height, ...]{}
\setkeys{Gin}{width=\maxwidth,height=\maxheight,keepaspectratio}
% Set default figure placement to htbp
\makeatletter
\def\fps@figure{htbp}
\makeatother

% Add LaTeX code into the preamble of the document here
\hyphenation{bio-di-ver-si-ty sap-lings}

% Define colors for text boxes
\definecolor{grey}{HTML}{F5F5F5}

% Define text box environments
\usepackage[tikz]{bclogo}
\newmdenv[
  style=boxstyle,
  backgroundcolor=grey,
  frametitlebackgroundcolor=grey,
]{greybox}

\usepackage[automake]{glossaries-extra}
\makeglossaries


\usepackage{amsmath}
\usepackage{booktabs}
\usepackage{caption}
\usepackage{longtable}
\makeatletter
\makeatother
\makeatletter
\@ifpackageloaded{bookmark}{}{\usepackage{bookmark}}
\makeatother
\makeatletter
\@ifpackageloaded{caption}{}{\usepackage{caption}}
\AtBeginDocument{%
\ifdefined\contentsname
  \renewcommand*\contentsname{Tabla de contenidos}
\else
  \newcommand\contentsname{Tabla de contenidos}
\fi
\ifdefined\listfigurename
  \renewcommand*\listfigurename{Listado de Figuras}
\else
  \newcommand\listfigurename{Listado de Figuras}
\fi
\ifdefined\listtablename
  \renewcommand*\listtablename{Listado de Tablas}
\else
  \newcommand\listtablename{Listado de Tablas}
\fi
\ifdefined\figurename
  \renewcommand*\figurename{Figura}
\else
  \newcommand\figurename{Figura}
\fi
\ifdefined\tablename
  \renewcommand*\tablename{Tabla}
\else
  \newcommand\tablename{Tabla}
\fi
}
\@ifpackageloaded{float}{}{\usepackage{float}}
\floatstyle{ruled}
\@ifundefined{c@chapter}{\newfloat{codelisting}{h}{lop}}{\newfloat{codelisting}{h}{lop}[chapter]}
\floatname{codelisting}{Listado}
\newcommand*\listoflistings{\listof{codelisting}{Listado de Listados}}
\makeatother
\makeatletter
\@ifpackageloaded{caption}{}{\usepackage{caption}}
\@ifpackageloaded{subcaption}{}{\usepackage{subcaption}}
\makeatother
\makeatletter
\@ifpackageloaded{tcolorbox}{}{\usepackage[skins,breakable]{tcolorbox}}
\makeatother
\makeatletter
\@ifundefined{shadecolor}{\definecolor{shadecolor}{rgb}{.97, .97, .97}}
\makeatother
\makeatletter
\makeatother
\makeatletter
\makeatother


% Additional content
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\graphicspath{{images/}}


% Chapter Summary environment
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\usepackage[tikz]{bclogo}
\newenvironment{Summary}
  {\begin{bclogo}[logo=\bctrombone, noborder=true, couleur=lightgray!50]{In
a Nutshell}\parindent0pt}
  {\end{bclogo}}
% Syntax:
%
%```{block, type='Summary'}
% Deliver message here.
% ```


% PDF title page to insert
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


% Fonts
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


% Local toc
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\usepackage{titletoc}
\newcommand{\toc}[1]{%
  \startcontents[chapters]%
  \printcontents[chapters]{}{1}[#1]{}%
  ~\newline%
}


% Text boxes
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Define a style for mdframed boxes
\mdfdefinestyle{boxstyle}{
	skipabove=1.5\topskip,
	skipbelow=.5\topskip,
	rightmargin=0pt,
	leftmargin=0pt,
	innerrightmargin=7pt,
	innerleftmargin=7pt,
	topline=false,
	bottomline=false,
	rightline=false,
	leftline=false,
	frametitlerule=true,
	linecolor=black,
	fontcolor=black,
	frametitlealignment=\noindent
}


% Layout
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% Based on memoir, style companion
\newcommand{\MemoirChapStyle}{daleif1}
\newcommand{\MemoirPageStyle}{Ruled}

% Space between paragraphs
\usepackage{parskip}
  \abnormalparskip{3pt}

% Adjust margin paragraphs vertical position
\usepackage{marginfix}


% Margins
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% allow use of '-',+','/' ans '*' to make simple length computation
\usepackage{calc}

% Full-width figures utilities
\newlength\widthw % full width
\newlength{\rf}
\newcommand*{\definesHSpace}{
  \strictpagecheck % slower but efficient detection of odd/even pages
  \checkoddpage
  \ifoddpage
  \setlength{\rf}{0mm}
  \else
  \setlength{\rf}{\marginparsep+\marginparwidth}
  \fi
}

\makeatletter
% 1" margins for the front matter.
\newcommand*{\SmallMargins}{
  \setlrmarginsandblock{1.5in}{1.5in}{*}
  \setmarginnotes{0.1in}{0.1in}{0.1in}
  \setulmarginsandblock{1.5in}{1in}{*}
  \checkandfixthelayout
  \ch@ngetext
  \clearpage
  \setlength{\widthw}{\textwidth+\marginparsep+\marginparwidth}
  \footnotesatfoot
  \chapterstyle{\MemoirChapStyle}  % Chapter and page styles must be recalled
  \pagestyle{\MemoirPageStyle}
}

% 3" outer margin for the main matter
\newcommand{\LargeMargins}{\SmallMargins}
\makeatother

% Figure captions and footnotes in outer margins


%% Bibliography
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% Repeated citation as author-year-title instead of author-title (modification of footcite:note in verbose-inote.cbx)


% memoiR dalef3 chapter style
% https://ctan.crest.fr/tex-archive/info/latex-samples/MemoirChapStyles/MemoirChapStyles.pdf
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\usepackage{soul}
\definecolor{nicered}{rgb}{.647,.129,.149}
\makeatletter
\newlength\dlf@normtxtw
\setlength\dlf@normtxtw{\textwidth}
\def\myhelvetfont{\def\sfdefault{mdput}}
\newsavebox{\feline@chapter}
% \so\protect\@chapapp replaces \so\@chapapp or \so will fail with babel
\newcommand\feline@chapter@marker[1][4cm]{%
  \sbox\feline@chapter{%
    \resizebox{!}{#1}{\fboxsep=1pt%
	  \colorbox{nicered}{\color{white}\bfseries\sffamily\thechapter}%
	}}%
  \rotatebox{90}{%
    \resizebox{%
	  \heightof{\usebox{\feline@chapter}}+\depthof{\usebox{\feline@chapter}}}%
	{!}{\scshape\so\protect\@chapapp}}\quad%
  \raisebox{\depthof{\usebox{\feline@chapter}}}{\usebox{\feline@chapter}}%
 }
\newcommand\feline@chm[1][4cm]{%
  \sbox\feline@chapter{\feline@chapter@marker[#1]}%
  \makebox[0pt][l]{% aka \rlap
    \makebox[1cm][r]{\usebox\feline@chapter}%
  }}
\makechapterstyle{daleif1}{
  \renewcommand\chapnamefont{\normalfont\Large\scshape\raggedleft\so}
  \renewcommand\chaptitlefont{\normalfont\huge\bfseries\scshape\color{nicered}}
  \renewcommand\chapternamenum{}
  \renewcommand\printchaptername{}
  \renewcommand\printchapternum{\null\hfill\feline@chm[2.5cm]\par}
  \renewcommand\afterchapternum{\par\vskip\midchapskip}
  \renewcommand\printchaptertitle[1]{\chaptitlefont\raggedleft ##1\par}
}
\makeatother


% scriptsize code
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\let\oldverbatim\verbatim
\def\verbatim{\oldverbatim\scriptsize}
% Applies to code blocks and R code results
% code chunk options size='scriptsize' applies only to R code and results
% if the code chunk sets a different size, \def\verbatim{...} is prioritary for code results


% Strict localized quotes
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Comes before \usepackage{csquotes} in pandoc template
\usepackage[strict,autostyle]{csquotes}

% End of pandoc.tex. Two line feeds are necessary to avoid commenting the next command
\ifLuaTeX
\usepackage[bidi=basic]{babel}
\else
\usepackage[bidi=default]{babel}
\fi
\babelprovide[main,import]{spanish}
% get rid of language-specific shorthands (see #6817):
\let\LanguageShortHands\languageshorthands
\def\languageshorthands#1{}
\ifLuaTeX
  \usepackage{selnolig}  % disable illegal ligatures
\fi
\usepackage[backend=biber,style=authoryear-ibid,isbn=false,backref=true,giveninits=true,uniquename=init,maxcitenames=2,maxbibnames=150,sorting=nyt,sortcites=false]{biblatex}
\addbibresource{references.bib}
\usepackage{csquotes}
\IfFileExists{bookmark.sty}{\usepackage{bookmark}}{\usepackage{hyperref}}
\IfFileExists{xurl.sty}{\usepackage{xurl}}{} % add URL line breaks if available
\urlstyle{same} % disable monospaced font for URLs
\hypersetup{
  pdftitle={Utilización de técnicas multivariantes para el estudio del aprendizaje de la mejora de la accesibilidad en el subtitulado de vídeos},
  pdfauthor={Javier Pérez Arteaga},
  pdflang={es},
  colorlinks=true,
  linkcolor={blue},
  filecolor={Maroon},
  citecolor={Blue},
  urlcolor={blue},
  pdfcreator={LaTeX via pandoc}}

% Title, author, date from YAML to LaTeX
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\title{Utilización de técnicas multivariantes para el estudio del
aprendizaje de la mejora de la accesibilidad en el subtitulado de
vídeos}

\author{Javier Pérez Arteaga}

\date{2023-10-03}


% Main title page with filigrane
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% Text blocks
\usepackage[absolute,overlay]{textpos}
  \setlength{\TPHorizModule}{1mm}
  \setlength{\TPVertModule}{1mm}

\newcommand{\MainTitlePage}[2]{
  \pagestyle{empty}
    \begin{center}
		\includegraphics[width=10cm]{images/logo.png}
		\LARGE
		\mbox{Universidad Nacional de Educación a Distancia}
		\LARGE
		\mbox{Escuela Técnica Superior de Informática}

		\LARGE
		\mbox{Máster en Ingeniería y Ciencia de Datos}

		\vspace{2cm}
		
		\LARGE
		\textbf{Trabajo Fin de Máster}
		
		\LARGE
		\textbf{\thetitle}

		
		\vspace{2cm}		
		
	\end{center}  
	
	\begin{flushright}
		\LARGE
		\begin{tabular}{ r l }
			Autor: & \theauthor \\
			Directores: & Emilio Letón Molina \\
			& Jorge Pérez Martín \\
			Fecha de realización: & \thedate
		\end{tabular}
		
	\end{flushright}

  \SmallMargins % Margins
  \newpage
  \textblockorigin{\trimedge}{\trimtop} % verso
  \begin{textblock*}{\textwidth}(\paperwidth-\spinemargin-\textwidth, \uppermargin)
    #1
  \end{textblock*}
  \begin{textblock*}{\textwidth}[0,1](\paperwidth-\spinemargin-\textwidth, \uppermargin+\textheight+\footskip)
    \centering
          \includegraphics[width=\paperwidth/4]{logo}\\ \bigskip
        #2
  \end{textblock*}
 
}

% Clear page and open an even one (\clearpage opens an odd one)
\newcommand{\evenpage}{
  \clearpage
  \strictpagecheck % slower but efficient detection of odd/even pages
  \checkoddpage
  \ifoddpage
    \thispagestyle{empty}
    ~\\ % Print a character or the page will not exist
    \newpage
  \else
    % do nothing
  \fi

  
}
\begin{document}
\frontmatter

% Title page
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


\MainTitlePage{This document is reproducible thanks to:

\begin{itemize}
  \item \LaTeX and its class memoir (\url{http://www.ctan.org/pkg/memoir}).
  \item R (\url{http://www.r-project.org/}) and RStudio (\url{http://www.rstudio.com/})
  \item bookdown (\url{http://bookdown.org/}) and memoiR (\url{https://ericmarcon.github.io/memoiR/})
\end{itemize}}{Name of the owner of the logo

\url{http://www.company.com}

An explanatory sentence. Leave an empty line for line breaks.}


\phantomsection % Necesario con hyperref
\selectlanguage{spanish} % Selección de idioma del resumen.
\makeatletter
\begin{center} %
\chapter*{Resumen} % Opción con * para que no aparezca en TOC ni numerada
\addcontentsline{toc}{chapter}{Resumen} % Añade al TOC.
\end{center}   
\makeatother
TODO: Incluir un resumen del trabajo.

\phantomsection % Necesario con hyperref
\chapter*{Agradecimientos} % Opción con * para que no aparezca en TOC ni numerada
\addcontentsline{toc}{chapter}{Agradecimientos} % Añade al TOC.

Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed malesuada nulla augue, ac facilisis risus pretium a. Ut bibendum risus id ex fermentum, at accumsan erat vulputate. In hac habitasse platea dictumst. Sed lobortis est a enim bibendum, ac pulvinar nulla aliquam. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. Pellentesque efficitur justo id suscipit pretium. Proin iaculis sit amet nibh vel euismod. Aenean tincidunt faucibus ex, non vehicula ipsum tristique in. Fusce vel tincidunt lectus, vel rutrum nisi. Suspendisse malesuada lectus ac enim vehicula rhoncus. Nullam convallis justo in bibendum eleifend.

Phasellus vitae magna nec mi sagittis luctus vitae eu augue. Donec scelerisque laoreet arcu, eget tempor mi ultricies vel. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. Vestibulum at blandit ex. Vestibulum eu sagittis mauris. In hac habitasse platea dictumst. Duis eget ante vel lacus sollicitudin convallis quis eu velit. Sed auctor sem non nisi hendrerit, vel tincidunt tortor bibendum.

\ifdefined\Shaded\renewenvironment{Shaded}{\begin{tcolorbox}[boxrule=0pt, sharp corners, frame hidden, enhanced, borderline west={3pt}{0pt}{shadecolor}, interior hidden, breakable]}{\end{tcolorbox}}\fi

% Contents
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% fix the typesetting of the part number
\renewcommand\partnumberlinebox[2]{#2\ ---\ }


\LargeMargins
{
\hypersetup{linkcolor=}
\setcounter{tocdepth}{1}
\tableofcontents
}

% Tables (of tables, of figures)
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\cleardoublepage
\LargeMargins
\listoftables

\cleardoublepage
\LargeMargins
\listoffigures

\input{latex/glossary.tex}

\mainmatter
\bookmarksetup{startatroot}

\hypertarget{introduccion}{%
\chapter{Introducción}\label{introduccion}}

\bookmarksetup{startatroot}

\hypertarget{motivaciuxf3n}{%
\chapter{Motivación}\label{motivaciuxf3n}}

\hypertarget{propuesta-y-objetivos}{%
\section{Propuesta y objetivos}\label{propuesta-y-objetivos}}

\hypertarget{estructura-del-documento}{%
\section{Estructura del documento}\label{estructura-del-documento}}

\bookmarksetup{startatroot}

\hypertarget{estado-del-arte}{%
\chapter{Estado del arte}\label{estado-del-arte}}

\bookmarksetup{startatroot}

\hypertarget{materiales}{%
\chapter{Materiales y métodos}\label{materiales}}

\bookmarksetup{startatroot}

\hypertarget{muxe9todos.}{%
\chapter{Métodos.}\label{muxe9todos.}}

\hypertarget{fuente-de-datos.}{%
\section{Fuente de datos.}\label{fuente-de-datos.}}

Los datos proceden de la edición de 2022 del curso MOOC Materiales
digitales accesibles de la UNED. Concretamente a los estudiantes
matriculados se les propuso que realizaran una actividad voluntaria
consistente en evaluar la calidad del subtitulado de dos vídeos. Los
vídeos eran idénticos y se diferenciaban únicamente en la calidad del
subtitulado. Los subtítulos de uno de los vídeos se realizaron
\autocites[ver][]{jperez1,jperez2} siguiendo las guía Web Content
Accessibility Guidelines 2.1 (WCAG 2.1) del W3C (World Wide Web
Consortium). El otro vídeo tenía un subtitulado similar pero se
introdujeron pequeñas deficiencias inapreciables para alguien que
carezca de conocimientos sobre accesibilidad. Los estudiantes fueron
clasificados en dos grupos. Al primer grupo se le presentó primero el
vídeo correctamente subtitulado y luego el otro. El segundo grupo
realizó la actividad cruzada: primero evaluó el vídeo mal subtitulado y
luego el bien subtitulado. Tras ver cada uno de los vídeos, los
estudiantes tuvieron la oportunidad de valorar la calidad del
subtitulado realizando un test en escala de Likert de 18 items y 5
niveles cada item \footnote{Para una descripción sobre cómo se debe
  realizar una escala de Likert consultar \textcite{likert1}.}. Los 18
items de Likert pretenden asegurar los criterios de la norma UNE 153010
\autocite[ver][]{aenor2012}.

En la Tabla~\ref{tbl-likert-levels} se muestran los 5 niveles de cada
uno de los items de la escala de Likert:

\clearpage

\hypertarget{tbl-likert-levels}{}
\begin{longtable}[]{@{}l@{}}
\caption{\label{tbl-likert-levels}Niveles de los items de la escala de
Likert.}\tabularnewline
\toprule\noalign{}
levels \\
\midrule\noalign{}
\endfirsthead
\toprule\noalign{}
levels \\
\midrule\noalign{}
\endhead
\bottomrule\noalign{}
\endlastfoot
No sé / No contesto \\
Muy en desacuerdo \\
En desacuerdo \\
Neutral \\
De acuerdo \\
Muy de acuerdo \\
\end{longtable}

En la Tabla~\ref{tbl-likert-scale} se muestran los 18 items de la escala
de Likert que se propuso a los alumnos para que evaluaran cada uno de
los vídeos:

\hypertarget{tbl-likert-scale}{}
\begin{longtable}{ll}
\caption{\label{tbl-likert-scale}Items de la escala de Likert. }\tabularnewline

\toprule
Item & Texto \\ 
\midrule
Q01 & La posición de los subtítulos. \\ 
Q02 & El número de líneas por subtítulo. \\ 
Q03 & La disposición del texto respecto a la caja donde se muestran los subtítulos. \\ 
Q04 & El contraste entre los caracteres y el fondo. \\ 
Q05 & La corrección ortográfica y gramatical. \\ 
Q06 & La literalidad. \\ 
Q07 & La identificación de los personajes. \\ 
Q08 & La asignación de líneas a los personajes en los diálogos. \\ 
Q09 & La descripción de efectos sonoros. \\ 
Q10 & La sincronización de las entradas y salidas de los subtítulos. \\ 
Q11 & La velocidad de exposición de los subtítulos. \\ 
Q12 & El máximo número de caracteres por línea. \\ 
Q13 & La legibilidad de la tipografía. \\ 
Q14 & La separación en líneas diferentes de sintagmas nominales, verbales y preposicionales. \\ 
Q15 & La utilización de puntos suspensivos. \\ 
Q16 & La escritura de los números. \\ 
Q17 & Las incorrecciones en el habla. \\ 
Q18 & Los subtítulos del vídeo cumplen en general con los requisitos de accesibilidad. \\ 
\bottomrule
\end{longtable}

Los datos personales de los estudiantes se suministraron anonimizados
para evitar ninguna referencia a su identidad. Del estudio se han
eliminado a aquellos estudiantes que, a pesar de haber realizado la
actividad, no dieron su autorización para que sus datos se utilizaran en
un estudio científicos.

\clearpage

Se dispuso de los siguientes ficheros \texttt{csv}:

\begin{itemize}
\tightlist
\item
  El fichero \texttt{grade} contiene el identificador de estudiante y el
  grupo al que pertenece (campo \texttt{cohort}).
\item
  El fichero \texttt{abo} es la información socioeconómica que
  voluntariamente ha aportado el estudiante: sexo, año nacimiento, nivel
  de estudios, ocupación .
\item
  El fichero \texttt{conoc} contiene el test de evaluación inicial de
  conocimientos del estudiante.
\item
  El fichero \texttt{exp} es la evaluación del curso realizada por cada
  estudiante.
\item
  El fichero \texttt{acc} contiene la información sobre accesibilidad
  que utiliza el estudiante.
\item
  Los ficheros \texttt{test1} y \texttt{test2} son las repuestas al test
  de Likert sobre la calidad del subtitulado del primer y del segundo
  vídeo realizado por cada grupo respectivamente.
\end{itemize}

\hypertarget{sec-diseno}{%
\section{Características del diseño del experimento.}\label{sec-diseno}}

El diseño del experimento es completamente aleatorizado, de respuesta
ordinal, cruzado \(AB/BA\) y doble ciego. Es decir que la asignación de
los estudiantes a cada grupo fue aleatoria; cada grupo vio los vídeos en
orden inverso; los estudiantes no conocían a priori qué vídeo estaban
viendo en cada momento y tampoco se disponía de esta información en el
momento de realizar el análisis estadístico de los datos.

Un diseño completamente aleatorizado \autocite[pp.~18]{lawson2015}
\enquote{garantiza la validez del experimento contra sesgos causados por
otras variables ocultas. Cuando las unidades experimentales se asignan
aleatoriamente a los niveles de factor de tratamiento, se puede realizar
una prueba exacta de la hipótesis de que el efecto del tratamiento es
cero utilizando una prueba de aleatorización}.

Siguiendo a \textcite{senn2022}, para que el ensayo sea de tipo cruzado
no sería suficiente intercambiar las secuencias sino que debe ser objeto
del ensayo el estudio de las diferencias entre los tratamientos
individuales que componen las secuencias. Los principales problemas d
eun diseño cruzado son el abandono, \texttt{drop-out}, de alguno de los
participantes y la interacción entre el tratamiento y el periodo o
\texttt{carry-over}. Además el análisis estadístico es más complicado y
particularmente cuando la respuesta es ordinal y hay más de dos
tratamientos. En la misma línea, \textcite{lui2016} afirma que
\enquote{el objetivo principal de un diseño cruzado es estudiar la
diferencia entre tratamientos individuales (en lugar de la diferencia
entre secuencias de tratamiento). Debido a que cada paciente sirve como
su propio control, el diseño cruzado es una alternativa útil al diseño
de grupos paralelos para aumentar la potencia}.

Las respuestas a un test de Likert se realizan en escala ordinal. No es
adecuado realizar operaciones aritméticas para calcular medias con este
tipo de datos. Pero ellos los test estadísticos para analizar el efecto
de un tratamiento con respuesta continua como son \(ANOVA\) y \(t\)-test
no son adecuados con datos ordinales. Según la investigación de
\textcite{kruschke20182018328} ajustar datos ordinales con modelos
cuantitativos puede producir los siguientes problemas:

\begin{itemize}
\tightlist
\item
  Se pueden encontrar diferencias significativas entre grupos cuando no
  las hay: Error tipo I.
\item
  Se pueden obviar diferencias cuando en realidad sí existen: Error tipo
  II.
\item
  Incluso se pueden invertir los efectos de un tratamiento.
\item
  También puede malinterpretarse la interacción entre factores.
\end{itemize}

Una opción es tratar los datos ordinales como si se tratara de datos
categóricos y utilizar técnicas no paramétricas como el test de
\(Kruskal-Wallis\). El problema de este tipo de técnicas es que ignoran
que los datos tienen una escala y, en el caso particular del diseño que
nos ocupa se trata de datos longitudinales, es decir, que se toman
varias medidas de cada sujeto y, por lo tanto, los datos no son
independientes. \textcite{agresti2010} expone un catálogo de técnicas
para analizar datos categóricos y ordinales.

\hypertarget{objetivo.}{%
\section{Objetivo.}\label{objetivo.}}

El objetivo del estudio es responder a la pregunta de investigación:

Son los estudiantes de un curso de accesibilidad capaces de encontrar
los errores en el subtitulado de un vídeo. Para ello se propondrán
diversos test y modelos estadísticos que tengan en consideración las
características que se han comentado en el diseño del experimento (ver
Sección~\ref{sec-diseno}). Particularmente se tendrá en cuenta que se
trata de un diseño cruzado con variable respuesta ordinal y variables
explicativas longitudinales.

\hypertarget{preprocesamiento.}{%
\section{Preprocesamiento.}\label{preprocesamiento.}}

Partiendo de los ficheros suministrados (ver Sección~\ref{sec-diseno}),
se realiza el siguiente preprocesado (para ver el código ejecutado
consultar Apéndice~\ref{sec-preprocess}):

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\item
  Se lee el fichero de perfil del usuario. El número de fila con el que
  el usuario aparece en el fichero se utilizará como identificador del
  usuario para mantener la trazabilidad y comprobar que las
  transformaciones realizadas son correctas.
\item
  Se eliminan del estudio a los estudiantes que aún habiendo realizado
  la actividad, no han dado su consentimiento para participar en el
  estudio.
\item
  El valor del campo \texttt{cohort} se sustituye por una letra \(A\) o
  \(B\) en función del grupo asignado. En este momento se desconoce qué
  vídeo vio primero cada grupo.
\item
  Se lee el fichero \texttt{profile} y se añade a los usuarios
  información sobre el sexo, el año de nacimiento y el novel de
  estudios.
\item
  Se lee el fichero \texttt{conoc} y se calcula cuántas preguntas acertó
  cada usuario en el test de evaluación de conocimientos previos. Se
  añade esta información al perfil del usuario.
\item
  Se leen los ficheros de test y se procesan. Se utiliza el nombre del
  fichero (\texttt{test1} o \texttt{test2}) para saber de qué vídeo se
  está respondiendo el test \footnote{Se reitera que en este momento se
    desconoce si el vídeo es el correctamente subtitulado o el otro. La
    única información que se almacena es si se está respondiendo al
    vídeo que se voy primero o al que se vio después.}.
\item
  Se seleccionan las preguntas que contienen las respuestas y se
  renombran para que sea más fácil saber de qué pregunta se trata
  \footnote{En los fichero suministrados pla respuesta a cada pregunta
    ocupa varios campos y se selecciona en cada pregunta el que contiene
    el valor de la respuesta y se convierte a numérico.}. Se convierte
  el campo \texttt{LastTry}, que contiene la fecha y hora de realización
  del test, a formato fecha y hora.
\item
  Se realizan algunas comprobaciones como la ausencia de valores nulos
  en la variables más relevantes o que no existan inconsistencias ni
  errores de procesado.
\item
  Se eliminan los comentarios y se graban en fichero aparte para que no
  revelen información que podría descubrir el tipo de subtitulado que
  piensa que está evaluando el estudiante.
\item
  Se almacenan los resultados de los test preprocesado en un fichero
  \texttt{csv}.
\end{enumerate}

\clearpage

\hypertarget{variables-relevantes.}{%
\section{Variables relevantes.}\label{variables-relevantes.}}

En la Tabla~\ref{tbl-variables} se describen las características más
relevantes de las principales variables que se utilizarán en en modelado
y en el análisis estadístico. \footnotesize

\hypertarget{tbl-variables}{}
\setlength{\LTpost}{0mm}
\begin{longtable}{llll}
\caption{\label{tbl-variables}Descripción de las variables más importantes }\tabularnewline

\toprule
Nombre & Desc & Tipo & Valores \\ 
\midrule
Response & Respuesta a las preguntas del test. & Factor ordenado & De 0 a 5\textsuperscript{1} \\ 
Treat & Subtítulos & Factor & A o B\textsuperscript{2} \\ 
Period & Periodo & Factor & 1 ó 2\textsuperscript{3} \\ 
Seq & Secuencia de aplicación de los tratamientos. & Factor & AB o BA \\ 
Subject & Identificación del estudiante & Factor & Numérico \\ 
Question & Número de la pregunta & Factor & Q01, Q02, ..., Q18\textsuperscript{4} \\ 
Cluster & Grupo de la pregunta & Factor & 1, 2, ó 3\textsuperscript{5} \\ 
\bottomrule
\end{longtable}
\begin{minipage}{\linewidth}
\textsuperscript{1}Se ha hecho una rotación sobre los valores originales. 0 = No sé, 1 = Muy en desacuerdo, ..., 5 Muy de acuerdo.\\
\textsuperscript{2}No se conoce si el tratamiento A es el subtitulado bueno o lo es el B.\\
\textsuperscript{3}1 para el primer vídeo visto y 2 el segundo.\\
\textsuperscript{4}Se ha reorganizado de tal forma que \$Q18\$, que es la pregunta resumen, sea el valor primero y de referencia.\\
\textsuperscript{5}Se aplicará una técnica estadística de agrupamiento para agregar las preguntas.\\
\end{minipage}

\normalsize

\bookmarksetup{startatroot}

\hypertarget{variables}{%
\chapter{Variables del modelo}\label{variables}}

\bookmarksetup{startatroot}

\hypertarget{resultados}{%
\chapter{Resultados}\label{resultados}}

\bookmarksetup{startatroot}

\hypertarget{conclusiones}{%
\chapter{Conclusiones y trabajo futuro}\label{conclusiones}}

\bookmarksetup{startatroot}

\hypertarget{referencias}{%
\chapter*{Referencias}\label{referencias}}
\addcontentsline{toc}{chapter}{Referencias}

\markboth{Referencias}{Referencias}

\printbibliography[heading=none]

\cleardoublepage
\phantomsection
\addcontentsline{toc}{part}{Apéndices}
\appendix

\hypertarget{sec-preprocess}{%
\chapter{Preprocesado de los ficheros
suministrados.}\label{sec-preprocess}}

Este es el código en R con el que se transforman los ficheros que se
suministran (ver Sección~\ref{sec-diseno}).

\footnotesize

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(readr)}
\FunctionTok{library}\NormalTok{(purrr)}
\FunctionTok{library}\NormalTok{(dplyr)}
\FunctionTok{library}\NormalTok{(magrittr)}
\FunctionTok{library}\NormalTok{(stringr)}
\FunctionTok{library}\NormalTok{(forcats)}
\FunctionTok{library}\NormalTok{(testit)}
\FunctionTok{library}\NormalTok{(tidyr)}

\DocumentationTok{\#\#\#\#\# GRADE \#\#\#\#\#}
\DocumentationTok{\#\# Usuarios que no quieren participar}
\NormalTok{no\_want\_users }\OtherTok{\textless{}{-}} \FunctionTok{read\_lines}\NormalTok{(}\StringTok{"data/original/ids\_a\_eliminar.txt"}\NormalTok{)}

\CommentTok{\# Leemos todos los archivos de grade CSV}
\NormalTok{grade\_files }\OtherTok{\textless{}{-}} \FunctionTok{list.files}\NormalTok{(}
    \StringTok{"data/original"}\NormalTok{, }\AttributeTok{pattern =} \StringTok{".*grade.*.csv"}\NormalTok{, }\AttributeTok{full.names =} \ConstantTok{TRUE}
\NormalTok{)}

\NormalTok{grade\_df }\OtherTok{\textless{}{-}} \FunctionTok{map\_dfr}\NormalTok{(}
\NormalTok{    grade\_files, }\SpecialCharTok{\textasciitilde{}} \FunctionTok{read\_delim}\NormalTok{(.x, }\AttributeTok{delim =} \StringTok{";"}\NormalTok{, }\AttributeTok{show\_col\_types =} \ConstantTok{FALSE}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
        \CommentTok{\# Añadimos el número de fila para mantener la trazabilidad}
        \FunctionTok{mutate}\NormalTok{(}\AttributeTok{Userid =} \FunctionTok{row\_number}\NormalTok{() }\SpecialCharTok{+} \DecValTok{1}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
        \CommentTok{\# Movemos las columnas de identificación de fila a la primera posición}
        \FunctionTok{relocate}\NormalTok{(Userid, }\AttributeTok{.before =} \DecValTok{2}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
        \CommentTok{\# Renombramos las columnas para que empiecen con mayúsculas}
        \FunctionTok{rename\_with}\NormalTok{(}\SpecialCharTok{\textasciitilde{}} \FunctionTok{str\_to\_title}\NormalTok{(.), }\FunctionTok{everything}\NormalTok{()) }\SpecialCharTok{\%\textgreater{}\%} 
        \CommentTok{\# Renombramos para que sea más fácil procesar el campo Cohort Name}
        \FunctionTok{rename}\NormalTok{(}\StringTok{"Cohort"} \OtherTok{=} \StringTok{"Cohort Name"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
        \CommentTok{\# Eliminamos valores nulos y los que no quieren participar}
        \FunctionTok{filter}\NormalTok{(}\SpecialCharTok{!}\FunctionTok{is.na}\NormalTok{(Cohort) }\SpecialCharTok{\&} \SpecialCharTok{!}\NormalTok{Username }\SpecialCharTok{\%in\%}\NormalTok{ no\_want\_users) }
\NormalTok{)}

\FunctionTok{assert}\NormalTok{(}\StringTok{"Comprobamos que no hay usuarios duplicados"}\NormalTok{, grade\_df }\SpecialCharTok{\%\textgreater{}\%} 
    \FunctionTok{nrow}\NormalTok{() }\SpecialCharTok{==}\NormalTok{ grade\_df }\SpecialCharTok{\%\textgreater{}\%}
    \FunctionTok{distinct}\NormalTok{(Username) }\SpecialCharTok{\%\textgreater{}\%}
    \FunctionTok{nrow}\NormalTok{())}

\CommentTok{\# Creamos un tibble que tiene un campo con letras en lugar del valor de Cohorte}
\NormalTok{(groups }\OtherTok{\textless{}{-}}\NormalTok{ grade\_df }\SpecialCharTok{\%\textgreater{}\%}
    \FunctionTok{distinct}\NormalTok{(Cohort) }\SpecialCharTok{\%\textgreater{}\%}
    \FunctionTok{arrange}\NormalTok{(Cohort) }\SpecialCharTok{\%\textgreater{}\%}
    \FunctionTok{mutate}\NormalTok{(}\AttributeTok{Group =}\NormalTok{ LETTERS[}\DecValTok{1}\SpecialCharTok{:}\FunctionTok{n}\NormalTok{()]))}

\CommentTok{\# Unimos los tibbles para asignar en grupo como letra en lugar de la cohorte}
\NormalTok{grade\_df }\OtherTok{\textless{}{-}} \FunctionTok{left\_join}\NormalTok{(grade\_df, groups) }\SpecialCharTok{\%\textgreater{}\%}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{select}\NormalTok{(Username, Userid, Group)}

\DocumentationTok{\#\#\#\#\# PROFILE \#\#\#\#\#}
\NormalTok{profile\_files }\OtherTok{\textless{}{-}} \FunctionTok{list.files}\NormalTok{(}
    \StringTok{"data/original"}\NormalTok{, }\AttributeTok{pattern =} \StringTok{".*student\_profile.*.csv"}\NormalTok{, }\AttributeTok{full.names =} \ConstantTok{TRUE}
\NormalTok{)}

\NormalTok{profile\_df }\OtherTok{\textless{}{-}} \FunctionTok{map\_dfr}\NormalTok{(}
\NormalTok{    profile\_files, }\SpecialCharTok{\textasciitilde{}} \FunctionTok{read\_delim}\NormalTok{(.x, }\AttributeTok{delim =} \StringTok{";"}\NormalTok{, }\AttributeTok{show\_col\_types =} \ConstantTok{FALSE}\NormalTok{)}
\NormalTok{)}

\NormalTok{grade\_df }\OtherTok{\textless{}{-}} \FunctionTok{left\_join}\NormalTok{(}
\NormalTok{    grade\_df, profile\_df }\SpecialCharTok{\%\textgreater{}\%}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{select}\NormalTok{(}\SpecialCharTok{{-}}\NormalTok{cohort), }\AttributeTok{by =} \FunctionTok{join\_by}\NormalTok{(Username }\SpecialCharTok{==}\NormalTok{ username)}
\NormalTok{)}


\DocumentationTok{\#\#\#\#\# CONOC \#\#\#\#\#}
\NormalTok{conoc\_files }\OtherTok{\textless{}{-}} \FunctionTok{list.files}\NormalTok{(}
    \StringTok{"data/original"}\NormalTok{, }\AttributeTok{pattern =} \StringTok{".*conoc.*.csv"}\NormalTok{, }\AttributeTok{full.names =} \ConstantTok{TRUE}\NormalTok{)}

\NormalTok{conoc\_df }\OtherTok{\textless{}{-}} \FunctionTok{map\_dfr}\NormalTok{(}
\NormalTok{    conoc\_files, }\SpecialCharTok{\textasciitilde{}} \FunctionTok{read\_delim}\NormalTok{(.x, }\AttributeTok{delim =} \StringTok{";"}\NormalTok{, }\AttributeTok{show\_col\_types =} \ConstantTok{FALSE}\NormalTok{)}
\NormalTok{)}

\NormalTok{conoc\_df }\OtherTok{\textless{}{-}}\NormalTok{ conoc\_df }\SpecialCharTok{\%\textgreater{}\%}
    \FunctionTok{filter}\NormalTok{(Tries }\SpecialCharTok{==} \DecValTok{1}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
    \FunctionTok{rowwise}\NormalTok{() }\SpecialCharTok{\%\textgreater{}\%}
    \FunctionTok{mutate}\NormalTok{(}
        \AttributeTok{level\_of\_knowledge =} 
            \FunctionTok{sum}\NormalTok{(}\FunctionTok{c\_across}\NormalTok{(}\FunctionTok{starts\_with}\NormalTok{(}\FunctionTok{paste}\NormalTok{(}\StringTok{"Q"}\NormalTok{, }\DecValTok{1}\SpecialCharTok{:}\DecValTok{10}\NormalTok{, }\StringTok{"C"}\NormalTok{, }\AttributeTok{sep =} \StringTok{""}\NormalTok{))) }\SpecialCharTok{==} \StringTok{"correct"}\NormalTok{)}
\NormalTok{    ) }\SpecialCharTok{\%\textgreater{}\%}
\NormalTok{    dplyr}\SpecialCharTok{::}\FunctionTok{select}\NormalTok{(User, level\_of\_knowledge)}

\NormalTok{grade\_df }\OtherTok{\textless{}{-}} \FunctionTok{left\_join}\NormalTok{(grade\_df, conoc\_df, }\AttributeTok{by =} \FunctionTok{join\_by}\NormalTok{(Username }\SpecialCharTok{==}\NormalTok{ User))}

\DocumentationTok{\#\#\#\#\# }\AlertTok{TEST}\DocumentationTok{ \#\#\#\#\#}
\CommentTok{\# Leemos todos los archivos de test CSV}
\NormalTok{test\_files }\OtherTok{\textless{}{-}} \FunctionTok{list.files}\NormalTok{(}
    \StringTok{"data/original"}\NormalTok{, }\AttributeTok{pattern =} \StringTok{".*test.*.csv"}\NormalTok{, }\AttributeTok{full.names =} \ConstantTok{TRUE}
\NormalTok{)}

\CommentTok{\# Leer todos los archivos de test y los combinamos en un dataframe}
\NormalTok{test\_df }\OtherTok{\textless{}{-}} \FunctionTok{map\_dfr}\NormalTok{(}
\NormalTok{    test\_files, }\SpecialCharTok{\textasciitilde{}} \FunctionTok{read\_delim}\NormalTok{(.x, }\AttributeTok{delim =} \StringTok{";"}\NormalTok{, }\AttributeTok{show\_col\_types =} \ConstantTok{FALSE}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
        \CommentTok{\# Añadimos un número de fila para mantener la trazabilidad}
        \FunctionTok{mutate}\NormalTok{(}\AttributeTok{Row =} \FunctionTok{row\_number}\NormalTok{() }\SpecialCharTok{+} \DecValTok{1}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
        \CommentTok{\# Añadimos la columna del número de test}
        \FunctionTok{mutate}\NormalTok{(}\AttributeTok{Test =} \FunctionTok{sprintf}\NormalTok{(}\StringTok{"\%02d"}\NormalTok{, }\FunctionTok{as.integer}\NormalTok{(}\FunctionTok{str\_extract}\NormalTok{(.x, }\StringTok{"(?\textless{}=test)}\SpecialCharTok{\textbackslash{}\textbackslash{}}\StringTok{d+"}\NormalTok{)))) }\SpecialCharTok{\%\textgreater{}\%}
        \CommentTok{\# Movemos las columnas de identificación de test y fila a la primera posición}
        \FunctionTok{relocate}\NormalTok{(}\FunctionTok{c}\NormalTok{(Test, Row), }\AttributeTok{.before =} \DecValTok{2}\NormalTok{) }
\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
    \CommentTok{\# eliminamos los usuarios que no quieren participar}
    \FunctionTok{filter}\NormalTok{(}\SpecialCharTok{!}\NormalTok{User }\SpecialCharTok{\%in\%}\NormalTok{ no\_want\_users) }

\NormalTok{num\_questions }\OtherTok{\textless{}{-}} \DecValTok{18}

\CommentTok{\# Nombre de los campos que contienen las respuestas al test}
\NormalTok{questions\_original }\OtherTok{\textless{}{-}} \FunctionTok{paste}\NormalTok{(}
    \StringTok{"Q"}\NormalTok{, }\FunctionTok{seq}\NormalTok{(}\AttributeTok{from =} \DecValTok{1}\NormalTok{, }\AttributeTok{by =} \DecValTok{2}\NormalTok{, }\AttributeTok{length.out =}\NormalTok{ num\_questions), }\StringTok{"R"}\NormalTok{, }\AttributeTok{sep =} \StringTok{""}
\NormalTok{) }

\CommentTok{\# Nombre de los campos que contienen las respuestas al test}
\NormalTok{comments\_original }\OtherTok{\textless{}{-}} \FunctionTok{paste}\NormalTok{(}
    \StringTok{"Q"}\NormalTok{, }\FunctionTok{seq}\NormalTok{(}\AttributeTok{from =} \DecValTok{2}\NormalTok{, }\AttributeTok{by =} \DecValTok{2}\NormalTok{, }\AttributeTok{length.out =}\NormalTok{ num\_questions }\SpecialCharTok{{-}} \DecValTok{1}\NormalTok{), }\StringTok{"R"}\NormalTok{, }\AttributeTok{sep =} \StringTok{""}
\NormalTok{) }

\CommentTok{\# Nombre de los campos que se usarán para renombrar los campos de respuesta al test}
\NormalTok{questions }\OtherTok{\textless{}{-}} \FunctionTok{sprintf}\NormalTok{(}\StringTok{"Q\%02d"}\NormalTok{, }\FunctionTok{seq}\NormalTok{(}\AttributeTok{from =} \DecValTok{1}\NormalTok{, }\AttributeTok{by =} \DecValTok{1}\NormalTok{, }\AttributeTok{length.out =}\NormalTok{ num\_questions)) }
\NormalTok{comments }\OtherTok{\textless{}{-}} \FunctionTok{sprintf}\NormalTok{(}\StringTok{"C\%02d"}\NormalTok{, }\FunctionTok{seq}\NormalTok{(}\AttributeTok{from =} \DecValTok{1}\NormalTok{, }\AttributeTok{by =} \DecValTok{1}\NormalTok{, }\AttributeTok{length.out =}\NormalTok{ num\_questions }\SpecialCharTok{{-}} \DecValTok{1}\NormalTok{))}
\NormalTok{columns }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}
    \StringTok{"Row"}\NormalTok{, }\StringTok{"Test"}\NormalTok{, }\StringTok{"User"}\NormalTok{, }\StringTok{"LastTry"}\NormalTok{, questions\_original, comments\_original}
\NormalTok{)}

\CommentTok{\# Procesamos el dataframe}
\CommentTok{\# Con este operador del paquete magrittr hacemos las transformaciones in situ}
\NormalTok{test\_df }\SpecialCharTok{\%\textless{}\textgreater{}\%} 
    \CommentTok{\# Eliminamos las filas que no contienen información}
    \FunctionTok{filter}\NormalTok{(Tries }\SpecialCharTok{\textgreater{}} \DecValTok{0}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
    \CommentTok{\# Convertimos LastTry a formato fecha}
    \FunctionTok{mutate}\NormalTok{(}\AttributeTok{LastTry =} \FunctionTok{strptime}\NormalTok{(LastTry, }\AttributeTok{format =} \StringTok{"\%Y{-}\%m{-}\%dT\%H:\%M:\%SZ"}\NormalTok{)) }\SpecialCharTok{\%\textgreater{}\%} 
    \CommentTok{\# Seleccionamos las columnas que nos interesan}
\NormalTok{    dplyr}\SpecialCharTok{::}\FunctionTok{select}\NormalTok{(}\FunctionTok{all\_of}\NormalTok{(columns)) }\SpecialCharTok{\%\textgreater{}\%} 
    \CommentTok{\# Extraemos la puntuación numérica de la pregunta}
    \FunctionTok{mutate}\NormalTok{(}\FunctionTok{across}\NormalTok{(questions\_original, }\SpecialCharTok{\textasciitilde{}} \FunctionTok{if\_else}\NormalTok{(}
        \FunctionTok{startsWith}\NormalTok{(.x, }\StringTok{"choice\_"}\NormalTok{), }\FunctionTok{as.integer}\NormalTok{(}\FunctionTok{str\_extract}\NormalTok{(.x, }\StringTok{"}\SpecialCharTok{\textbackslash{}\textbackslash{}}\StringTok{d+"}\NormalTok{)), }\ConstantTok{NA\_integer\_}\NormalTok{)}
\NormalTok{    )) }\SpecialCharTok{\%\textgreater{}\%}
    \CommentTok{\# Renombramos los respuestas para que sean secuenciales}
    \FunctionTok{rename}\NormalTok{(}
        \FunctionTok{setNames}\NormalTok{(questions\_original, questions),}
        \FunctionTok{setNames}\NormalTok{(comments\_original, comments)}
\NormalTok{    ) }\SpecialCharTok{\%\textgreater{}\%}
    \CommentTok{\# nos aseguramos de que el orden filas es el mismo que el de los ficheros.}
    \FunctionTok{arrange}\NormalTok{(}\StringTok{"Test"}\NormalTok{, }\StringTok{"Row"}\NormalTok{) }

\CommentTok{\# Guardamos el número de filas para posterior comprobación}
\NormalTok{n\_test }\OtherTok{\textless{}{-}}\NormalTok{ test\_df }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{nrow}\NormalTok{()}

\CommentTok{\# Unimos los dataframes para tener el grupo y el UserID secuencial}
\NormalTok{test\_df }\OtherTok{\textless{}{-}} \FunctionTok{inner\_join}\NormalTok{(}
\NormalTok{    test\_df, grade\_df, }\AttributeTok{by =} \FunctionTok{join\_by}\NormalTok{(User }\SpecialCharTok{==}\NormalTok{ Username)}
\NormalTok{    ) }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{relocate}\NormalTok{(Group, }\AttributeTok{.before =} \DecValTok{2}\NormalTok{)}

\CommentTok{\# Cambiamos los valores del campo User por los del UserID}
\NormalTok{test\_df }\SpecialCharTok{\%\textless{}\textgreater{}\%}
    \FunctionTok{mutate}\NormalTok{(}\AttributeTok{User =}\NormalTok{ Userid) }\SpecialCharTok{\%\textgreater{}\%}
\NormalTok{    dplyr}\SpecialCharTok{::}\FunctionTok{select}\NormalTok{(}\SpecialCharTok{{-}}\NormalTok{Userid) }\SpecialCharTok{\%\textgreater{}\%}
    \FunctionTok{arrange}\NormalTok{(User, Test) }\CommentTok{\# Ordenamos por usuario y test}


\DocumentationTok{\#\#\#\#\# CHECKS \#\#\#\#\#}
\FunctionTok{assert}\NormalTok{(}
    \StringTok{"Comprobamos que no hay preguntas duplicadas en el dataframe de test"}\NormalTok{,}
\NormalTok{    n\_test }\SpecialCharTok{==}\NormalTok{ test\_df }\SpecialCharTok{\%\textgreater{}\%}
    \FunctionTok{distinct}\NormalTok{(Group, Test, User) }\SpecialCharTok{\%\textgreater{}\%}
    \FunctionTok{nrow}\NormalTok{()}
\NormalTok{)}

\FunctionTok{assert}\NormalTok{(}
    \StringTok{"Comprobamos que no hay valores nulos"}\NormalTok{,}
\NormalTok{    test\_df }\SpecialCharTok{\%\textgreater{}\%} 
\NormalTok{    dplyr}\SpecialCharTok{::}\FunctionTok{select}\NormalTok{(}
        \SpecialCharTok{{-}}\FunctionTok{c}\NormalTok{(comments, year\_of\_birth, gender, level\_of\_education, level\_of\_knowledge)}
\NormalTok{    ) }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{filter}\NormalTok{(}\FunctionTok{if\_any}\NormalTok{(}\FunctionTok{everything}\NormalTok{(), is.na)) }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{nrow}\NormalTok{() }\SpecialCharTok{==} \DecValTok{0}\NormalTok{)}


\FunctionTok{assert}\NormalTok{(}
    \StringTok{"Comprobamos que no hay respuestas con valores incorrectos"}\NormalTok{,}
    \FunctionTok{sum}\NormalTok{(}\FunctionTok{sort}\NormalTok{(}\FunctionTok{unique}\NormalTok{(}\FunctionTok{unlist}\NormalTok{(}
\NormalTok{        test\_df }\SpecialCharTok{\%\textgreater{}\%}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{select}\NormalTok{(}\FunctionTok{all\_of}\NormalTok{(questions))}
\NormalTok{    ))) }\SpecialCharTok{==} \DecValTok{0}\SpecialCharTok{:}\DecValTok{5}\NormalTok{) }\SpecialCharTok{==} \DecValTok{6}\NormalTok{)}


\NormalTok{comments\_df }\OtherTok{\textless{}{-}}\NormalTok{ test\_df }\SpecialCharTok{\%\textgreater{}\%}
    \FunctionTok{pivot\_longer}\NormalTok{(}
        \AttributeTok{cols =} \FunctionTok{starts\_with}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\StringTok{"Q"}\NormalTok{, }\StringTok{"C"}\NormalTok{)),}
        \AttributeTok{names\_to =} \FunctionTok{c}\NormalTok{(}\StringTok{".value"}\NormalTok{, }\StringTok{"Question"}\NormalTok{),}
        \AttributeTok{names\_pattern =} \StringTok{"(Q|C)(.*)"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
    \FunctionTok{rename}\NormalTok{(}\AttributeTok{Response =}\NormalTok{ Q, }\AttributeTok{Comment =}\NormalTok{ C) }\SpecialCharTok{\%\textgreater{}\%}
    \FunctionTok{filter}\NormalTok{(}\SpecialCharTok{!}\FunctionTok{is.na}\NormalTok{(Comment) }\SpecialCharTok{\&} \FunctionTok{grepl}\NormalTok{(}\StringTok{"[a{-}zA{-}Z]"}\NormalTok{, Comment)) }\SpecialCharTok{\%\textgreater{}\%}
\NormalTok{    dplyr}\SpecialCharTok{::}\FunctionTok{select}\NormalTok{(Test, Row, Group, User, Question, Response, Comment) }\SpecialCharTok{\%\textgreater{}\%}
    \FunctionTok{arrange}\NormalTok{(Test, Group, Response, Row)}


\FunctionTok{write\_csv}\NormalTok{(comments\_df, }\StringTok{"./data/preprocess/comments.csv"}\NormalTok{)}

\DocumentationTok{\#\#\#\#\# SAVE TO FILE \#\#\#\#\#}
\FunctionTok{write\_csv}\NormalTok{(}
\NormalTok{    test\_df }\SpecialCharTok{\%\textgreater{}\%}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{select}\NormalTok{(}\SpecialCharTok{{-}}\FunctionTok{all\_of}\NormalTok{(comments)), }\StringTok{"./data/preprocess/test.csv"}
\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\normalsize


\backmatter
% Bibliography
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\SmallMargins

\onecolumn


% Back cover
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% Even page, small margins, no running head, no page number.
\evenpage
\SmallMargins
\thispagestyle{empty}

\begin{normalsize}

\begin{description}

\selectlanguage{spanish}
\item[Abstract]
English abstract, on the last page.

This is a bookdown template based on LaTeX memoir class.
\item[Keywords]
Keyword in English, As a list.
~\\

\end{description}

\end{normalsize}

\end{document}
