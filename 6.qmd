```{r}
source("_setup.R")
```

# Discusión {#sec-discusion}


```{r}
#| eval: true
#| cache: false

q.errors <- c("Q02", "Q05", "Q06", "Q07", "Q08", "Q09", "Q10", "Q11", "Q12", "Q14", "Q18")
q.no.errors <- setdiff(levels(df_response$Item), q.errors)
``` 


```{r}
#| eval: true
#| cache: false

improve_question <- 1 / (1 + exp(-ranef(glmer_improve_subject_question)$Item - fixef(glmer_improve_subject_question)))

improve_question <- cbind(rownames(improve_question), improve_question)
colnames(improve_question) <- c("Item", "Prob")

g <- inner_join(
    df_improve %>% group_by(Item) %>% summarize(n = n(), improve = sum(Improve), Freq = improve / n) %>% select(Item, Freq),
    improve_question
) %>%
    gt() %>%
    fmt_percent(decimals = 1) %>%
    data_color(
        rows = Item %in% q.no.errors, columns = Prob, palette = "ggsci::grey_material", target_columns = c(Freq, Item, Prob)
    ) %>%
    data_color(
        rows = Item %in% q.errors, columns = Prob, palette = "ggsci::purple_material", target_columns = c(Freq, Item, Prob), reverse = T
    ) %>%
    cols_align(align = "center", columns = everything()) %>%
    tab_style(style = cell_text(weight = "bold"), cells_body(rows = Item %in% q.errors))

gtsave(g, "images/improve.png", cliprect = c(321, -10, 323, 712))
```

```{r}
newdata <- df_response %>%
    select(Treat, Item) %>%
    distinct()

Prob <- predict(glmer_positive_treat_subject_question,
    type = "response", newdata = newdata,
    re.form = ~ (1 + Treat | Item)
)

df_positive <- cbind(newdata, Prob)
df_positive <- inner_join(
    df_response %>%
        group_by(Treat, Item) %>%
        summarize(Freq = sum(Level == "Positivo") / n()) %>%
        ungroup(),
    df_positive
)
df_positive <- df_positive %>%
    pivot_wider(id_cols = Item, names_from = Treat, values_from = c(Freq, Prob)) %>%
    select(1, 2, 4, 3, 5)

g2 <- df_positive %>%
    gt() %>%
    cols_label_with(columns = -1, fn = function(x) substr(x, 1, nchar(x) - 2)) %>%
    tab_spanner(label = "Treat A", ends_with("_A")) %>%
    tab_spanner(label = "Treat B", ends_with("_B")) %>%
    data_color(rows = Item %in% q.no.errors, columns = Prob_B, palette = "ggsci::grey_material", target_columns = c(Freq_B, Item, Prob_B), reverse = T) %>%
    data_color(rows = Item %in% q.errors, columns = Prob_B, palette = "ggsci::purple_material", target_columns = c(Freq_B, Item, Prob_B), reverse = F) %>%
    fmt_percent(decimals = 1) %>%
    cols_align(align = "center", columns = everything()) %>%
    tab_style(style = cell_text(weight = "bold"), cells_body(rows = Item %in% q.errors))

gtsave(g2, "images/positive.png", expand = c(0, 15, 0, 0))
```


\scriptsize
```{r}
#| eval: true
#| cache: false
#|
set.seed(100)
df_prob_data <- df_response %>%
    dplyr::select(Subject, Period, Seq, Treat, Response, Item) %>%
    arrange(Treat, Item, Response) %>%
    group_by(Treat, Item, Response, .drop = F) %>%
    summarize(n = n()) %>%
    ungroup(Response) %>%
    mutate(acc = cumsum(n), `Prob_data` = n / last(acc)) %>%
    pivot_wider(
        id_cols = c(Treat, Item),
        names_from = c(Response),
        values_from = c(Prob_data),
        names_glue = "{Response}_{.value}"
    )

df_prob_model <- epred_draws(brm_treat.period.subject.item, expand.grid(list(Period = c(1, 2), Treat = levels(df_response$Treat), Item = levels(df_response$Item))), re_formula = ~ (1 + Treat | Item)) %>%
    group_by(Treat, Item, .category) %>%
    summarize(q10 = quantile(.epred, probs = 0.1), q50 = quantile(.epred, probs = 0.5), q90 = quantile(.epred, probs = 0.9)) %>%
    ungroup() %>%
    pivot_wider(
        names_from = c(.category),
        values_from = c(q10, q50, q90),
        names_glue = "{.category}_{.value}"
    )

g3 <- inner_join(df_prob_data, df_prob_model) %>%
    pivot_wider(id_cols = Item, names_from = Treat, values_from = starts_with(paste(1:5))) %>%
    dplyr::select(Item, ends_with("A"), ends_with("B")) %>%
    ungroup() %>%
    gt() %>%
    fmt_number(columns = contains("_q"), decimals = 1, scale = 100) %>%
    fmt_percent(columns = contains("_data"), decimals = 1) %>%
    cols_merge(columns = c("1_q10_A", "1_q50_A", "1_q90_A"), pattern = "{2}% <br> <span style='font-size: 10px;'>({1}-{3})</span>") %>%
    cols_merge(columns = c("2_q10_A", "2_q50_A", "2_q90_A"), pattern = "{2}% <br> <span style='font-size: 10px;'>({1}-{3})</span>") %>%
    cols_merge(columns = c("3_q10_A", "3_q50_A", "3_q90_A"), pattern = "{2}% <br> <span style='font-size: 10px;'>({1}-{3})</span>") %>%
    cols_merge(columns = c("4_q10_A", "4_q50_A", "4_q90_A"), pattern = "{2}% <br> <span style='font-size: 10px;'>({1}-{3})</span>") %>%
    cols_merge(columns = c("5_q10_A", "5_q50_A", "5_q90_A"), pattern = "{2}% <br> <span style='font-size: 10px;'>({1}-{3})</span>") %>%
    cols_merge(columns = c("1_q10_B", "1_q50_B", "1_q90_B"), pattern = "{2}% <br> <span style='font-size: 10px;'>({1}-{3})</span>") %>%
    cols_merge(columns = c("2_q10_B", "2_q50_B", "2_q90_B"), pattern = "{2}% <br> <span style='font-size: 10px;'>({1}-{3})</span>") %>%
    cols_merge(columns = c("3_q10_B", "3_q50_B", "3_q90_B"), pattern = "{2}% <br> <span style='font-size: 10px;'>({1}-{3})</span>") %>%
    cols_merge(columns = c("4_q10_B", "4_q50_B", "4_q90_B"), pattern = "{2}% <br> <span style='font-size: 10px;'>({1}-{3})</span>") %>%
    cols_merge(columns = c("5_q10_B", "5_q50_B", "5_q90_B"), pattern = "{2}% <br> <span style='font-size: 10px;'>({1}-{3})</span>") %>%
    cols_label_with(
        fn = function(x) substr(x, 1, 1), columns = matches("Prob|[1-5]")
    ) %>%
    tab_spanner(label = "Data Frequencies", ends_with("Prob_data_A"), level = 1, id = "data_A") %>%
    tab_spanner(label = html("<div style='display: flex; justify-content: space-evenly; align-items: center; width: 100%'><div>Model Prob. Quantiles</div><div>50%</div><div style='font-size: 10px'>(10%, 90%)</div></div>"), ends_with("_q10_A"), level = 1, id = "model_A") %>%
    tab_spanner(label = "Data Frequencies", ends_with("Prob_data_B"), level = 1, id = "data_B") %>%
    tab_spanner(label = html("<div style='display: flex; justify-content: space-evenly; align-items: center; width: 100%'><div>Model Prob. Quantiles</div><div>50%</div><div style='font-size: 10px'>(10%, 90%)</div></div>"), ends_with("_q10_B"), level = 1, id = "model_B") %>%
    tab_spanner(label = "Treat A", ends_with("_A"), level = 2) %>%
    tab_spanner(label = "Treat B", ends_with("_B"), level = 2) %>%
    data_color(method = "numeric", columns = ends_with("A"), palette = "ggsci::blue_material", direction = "row") %>%
    data_color(method = "numeric", columns = ends_with("B"), palette = "ggsci::orange_material", direction = "row") %>%
    cols_align(align = "center", columns = everything()) %>%
    tab_style(style = cell_borders(sides = c("top", "bottom"), color = "blue", weight = px(3.5), style = "dashed"), locations = cells_body(rows = Item %in% q.errors, columns = ends_with("_A"))) %>%
    tab_style(
        style = cell_borders(sides = c("right"), color = "blue", weight = px(3.5), style = "dashed"),
        locations = cells_body(rows = Item %in% q.errors, columns = Item)
    ) %>%
    tab_style(
        style = cell_borders(sides = c("top", "bottom"), color = "#ff4d00", weight = px(3.5), style = "dashed"),
        locations = cells_body(rows = Item %in% q.errors, columns = ends_with("_B"))
    ) %>%
    tab_style(
        style = cell_borders(sides = c("right"), color = "#ff4d00", weight = px(3.5), style = "dashed"),
        locations = cells_body(rows = Item %in% q.errors, columns = "5_q10_B")
    ) %>%
    gt_highlight_rows(rows = Item %in% q.errors, columns = Item) %>%
    tab_style(style = cell_text(weight = "bold"), cells_body(rows = Item %in% q.errors))

gtsave(g3, "images/bayes-probs.png", vwidth = 1500, expand = c(0, 15, 0, 0))

# g %>% as_raw_html()
```
\normalsize


```{r}
comments_df <- read_delim(
    "./data/preprocess/comments.csv",
    delim = ",", show_col_types = FALSE
)
```



En esta sección se discuten los resultados una vez "descubierto el ciego" y se responden a las preguntas de investigación planteadas en la @sec-objetivos. Se reveló que el subtitulado que en este trabajo se ha denominado $A$ se corresponde que el vídeo correctamente subtitulado. Adicionalmente se ha suministrado un documento que contiene los errores introducidos en el subtitulado $B$. A partir del mismo, se ha elaborado la Tabla \ref{tbl-blind-errors} en la que se muestra la correspondencia de cada error con los ítems de la escala de Likert a la que respondieron los estudiantes (ver en la @tbl-likert-scale una descripción textual de cada ítem). Para `r length(q.no.errors)` de los `r length(q.no.errors) + length(q.errors)` ítems (`r paste(q.no.errors, collapse=", ")`) no se ha encontrado una adscripción clara en el documento de errores y, por lo tanto, sería deseable una valoración similar entre subtitulados en esos ítems.

```{=tex}
\begin{table}[H]
\caption{\label{tbl-blind-errors}Correspondencia entre los errores introducidos en el subtitulado del vídeo B y los ítems de la escala de Likert.}\tabularnewline
\tiny
\begin{adjustwidth}{-2.5cm}{}
\begin{tabular}{@{}|c|l|l|l|@{}}
\toprule
\multicolumn{1}{|l|}{\textbf{Error nº}} &
  \textbf{Subtítulo} &
  \textbf{Requisito que se incumple} &
  \textbf{Ítems} \\ \midrule
1 &
  \begin{tabular}[c]{@{}l@{}}Correcto:\\ Hola, este vídeo nos va a servir\\ \\ Incorrecto:\\ Hola este video nos ba a servir\end{tabular} &
  \begin{tabular}[c]{@{}l@{}}Los subtítulos deben ser correctos\\ ortográfica y gramaticalmente.\end{tabular} &
  Q05 \\ \midrule
2 &
  \begin{tabular}[c]{@{}l@{}}Correcto: para hacer una práctica de subtitulado\\ \\ Incorrecto: para hacer una prácti\\ ca de subtitulado\end{tabular} &
  \begin{tabular}[c]{@{}l@{}}No se deben separar en dos líneas\\ las sílabas de la misma palabra.\end{tabular} &
   \\ \midrule
3 &
   &
  \begin{tabular}[c]{@{}l@{}}Los subtítulos deben ocupar\\ dos líneas y, excepcionalmente tres.\end{tabular} &
  Q02 \\ \midrule
4 &
   &
  \begin{tabular}[c]{@{}l@{}}Las conjunciones y los nexos\\ deben ir en la línea inferior.\end{tabular} &
  Q14 \\ \midrule
5 &
  \begin{tabular}[c]{@{}l@{}}Incorrecto: El texto del subtítulo es válido,\\ pero su entrada debe producirse antes para que\\ coincida con la información sonora.\end{tabular} &
  \begin{tabular}[c]{@{}l@{}}Las entradas y salidas de los subtítulos\\ deben coincidir con el movimiento labial,\\ con la locución y/o con la información sonora.\end{tabular} &
  Q10, Q09 \\ \midrule
6 &
  \begin{tabular}[c]{@{}l@{}}Correcto: (Teléfono) Perdonad\\ \\ Incorrecto: Perdonad\end{tabular} &
  \begin{tabular}[c]{@{}l@{}}Deben describirse los efectos sonoros\\ que sean relevantes para la comprensión del vídeo.\end{tabular} &
  Q09 \\ \midrule
7 &
  \begin{tabular}[c]{@{}l@{}}Correcto: ¿Dígame? \\ (EMI) Hola, soy Emilio.\\ \\ Incorrecto: ¿Dígame? (EMI) Hola, soy Emilio.\end{tabular} &
  \begin{tabular}[c]{@{}l@{}}Para cada participante en el diálogo\\ debe comenzarse una nueva línea.\end{tabular} &
  Q08 \\ \midrule
8 &
  \begin{tabular}[c]{@{}l@{}}Correcto:\\ (ALE) Emilio, muy buenas. Mira,\\ precisamente estoy grabando el vídeo\\ \\ Incorrecto:\\ (ALE) Emilio, muy buenas. Mira, precisamente estoy grabando el vídeo\end{tabular} &
  \begin{tabular}[c]{@{}l@{}}El máximo número de caracteres\\ por línea es 37.\end{tabular} &
  Q12 \\ \midrule
9 &
  \begin{tabular}[c]{@{}l@{}}Incorrecto: El texto del subtítulo es válido,\\ pero su duración debe ser de al menos 3 segundos.\end{tabular} &
  \begin{tabular}[c]{@{}l@{}}La velocidad de exposición del subtítulo\\ debe permitir leerlo sin dificultad.\\ La velocidad recomendada para los subtítulos\\ es de unos 12 caracteres por segundo.\end{tabular} &
  Q11 \\ \midrule
10 &
  \begin{tabular}[c]{@{}l@{}}Correcto: Luego voy a verte al despacho ¿de acuerdo?\\ \\ Incorrecto: Luego voy a verte al despacho ¿Ok?\end{tabular} &
  Los subtítulos deben ser literales. &
  Q06 \\ \midrule
11 &
  \begin{tabular}[c]{@{}l@{}}Correcto: (EMI) Muy bien, estupendo. Aquí estaré. \\ (ALE) Hasta luego\\ \\ Incorrecto: Muy bien, estupendo. Aquí estaré. \\ Hasta luego\end{tabular} &
  \begin{tabular}[c]{@{}l@{}}Los diferentes personajes que intervienen en la\\ obra audiovisual deben estar claramente identificados.\end{tabular} &
  Q07 \\ \bottomrule
\end{tabular}
\end{adjustwidth}
\normalsize
\end{table}
```


Para responder a las preguntas de investigación se van a utilizar los hallazgos del Análisis Exploratorio (ver @sec-eda) y los resultados de los tres modelos comentados en el @sec-resultados. A saber:

* Regresión Logística con variable respuesta `Improve`, que calcula la probabilidad de que la respuesta a un ítem mejore entre subtitulados $A$ > $B$ (ver @sec-logistica-3).
* Regresión Logística con variable respuesta `Positive`, que calcula la probabilidad de que la respuesta a un ítem sea positiva (4 ó 5).
* Regresión Ordinal con variable Respuesta `Response`, que calcula la probabilidad de cada nivel de respuesta (ver @sec-ordinal-3).

Por comodidad se vuelven a plantear aquí las preguntas de investigación:

::: {.callout-note}
## Pregunta de investigación

¿Son los estudiantes de un curso de creación de materiales accesibles capaces de encontrar diferencias en la calidad del subtitulado de un vídeo?
:::

El subtitulado $A$, que es el correcto, ha sido indubitablemente preferido por los estudiantes. Esto se ha constatado tanto en la exploración inicial como en cada uno de los tres modelos propuestos. Por ejemplo, en la exploración inicial se vio que la respuesta más frecuente en el subtitulado $A$ es 5 y en el $B$ es 4. El modelo con variable respuesta `Improve` predice que la probabilidad de que se otorgue una mayor puntuación en $A$ que en $B$ es `r paste(round(100/(1+exp(-fixef(glmer_improve_subject_question)[[1]])),2),"%", sep="")`. Por lo tanto, se concluye respondiendo afirmativamente a la pregunta: los estudiantes del curso han sabido reconocer diferencias en el subtitulado de los vídeos.


::: {.callout-tip}
## Objetivos específicos

¿Qué aspectos de la calidad del subtitulado son más fácilmente reconocibles por los estudiantes y en cuáles existe mayor dificultad?
:::

La respuesta a esta pregunta requiere un análisis pormenorizado ítem a ítem. Se ha elaborado una tabla para cada uno de los tres modelos. La @fig-logistic-compare contiene las tablas correspondientes a los dos modelos de Regresión Logística. Para su correcta interpretación se deben tener en cuenta las siguientes pautas:

* La columna `Freq` es la frecuencia relativa de las tablas de contingencia. La columna `Prob` son las probabilidades predichas por cada uno de los modelos.
* Los ítems de Likert en los que hay errores en el subtitulado $B$ se han resaltado con letra negrilla y fondo color púrpura. En los que no hay errores la letra es normal y el fondo gris.
* Cuanto más oscuro sea el color de fondo más inesperado es el resultado. 

En el modelo con variable respuesta `Improve` (ver @fig-or-improve), los alumnos han sabido reconocer los ítems en los que no se han introducido errores (en los ítems comoo el $Q01$ y $Q03$ con mucha incertidumbre). También han sido capaces de identificar correctamente errores de subtitulado en $Q05$ (`r tolower(question_labels[6])`), $Q06$ (`r tolower(question_labels[7])`), $Q07$ (`r tolower(question_labels[8])`), $Q08$ (`r tolower(question_labels[9])`), $Q09$ (`r tolower(question_labels[10])`) y $Q14$ (`r tolower(question_labels[15])`).
SIn embargo hay ítems en los que sí se han introducido errores y sin embargo los alumnos apenas los han reflejado en sus valoraciones han sido:

* $Q02$ (`r tolower(question_labels[3])`) probabilidad predicha de mejorar la valoración `r paste(round(100*(improve_question$Prob)[3],2),"%",sep="")`.
* $Q10$ (`r tolower(question_labels[11])`) probabilidad `r paste(round(100*(improve_question$Prob)[11],2),"%",sep="")`.
* $Q11$ (`r tolower(question_labels[12])`) probabilidad `r paste(round(100*(improve_question$Prob)[12],2),"%",sep="")`.
* $Q12$ (`r tolower(question_labels[13])`) probabilidad `r paste(round(100*(improve_question$Prob)[13],2),"%",sep="")`.

La @fig-or-positive muestra las predicciones del modelo con variable respuesta `Positive` de obtener una respuesta con nivel 4 ó 5. Las conclusiones que se pueden extraer son muy similares a las del modelo con variable respuesta `Improve`. Los ítems $Q15$, $Q16$ y $Q17$ son ítems que tienen una valoración comparativamente baja en ambos subtitulados e inferior en el $B$ que en el $A$ y ninguna de estas cosas debería haber sucedido ya que no se han introducido este tipo de errores.

::: {#fig-logistic-compare layout-ncol=2}

![Modelo Improve (respuesta A > B)](images/improve.png){#fig-or-improve}

![Modelo Positive (respuesta es 4 ó 5)](images/positive.png){#fig-or-positive}

Predicciones de los modelos de Regresión Logística
:::

En la \ref{fig-prob-compare} se muestra la probabilidad de nivel de respuesta por ítem y nivel de subtitulado correspondiente al modelo de Regresión Ordinal y se compara con la frecuencia de la tabla de contingencia. Los ítems con errores se muestran en negrita y recuadrados. Se observa que en el subtitulado $A$ todas las respuestas a los ítems se concentran en valores positivos (4 ó 5). En este subtitulado $A$ los ítems $Q15$, $Q16$ y $Q17$ reciben bastantes respuestas negativas
[^El modelo ordinal no es capaz de predecir esto debido a que, como estos ítems recibieron muchas contestaciones "No sé / No contesto", y éstas se han eliminado del análisis, el efecto "regresión a la media" que produce el modelado en estos ítems es grande.].

En el subtitulado $B$ esperamos que los ítems en los que se han introducido errores tengan peores valoraciones. Esto sucede claramente en $Q05$ y en $Q09$ y también aunque en menor medida en $Q06$, $Q07$, $Q08$ y $Q14$. En $Q18$ (`r tolower(question_labels[1])`) también se observan claras diferencias indicando que los estudiantes han identificado con claridad que $B$ es el subtitulado con errores. Sin embargo, hay una gran incertidumbre en las respuestas a los ítems $Q02$, $Q10$, $Q11$ y $Q12$ en todos ellos hay más respuestas negativas que en el subtitulado $A$ pero se mantiene un elevado porcentaje de respuestas positivas. En los ítems en los que no se han introducido errores se deberían observar similares respuestas que en el subtitulado $A$. Esto sucede en $Q04$, $Q13$, $Q15$, $Q16$ y $Q17$. Sin embargo los ítems $Q01$ y $Q03$ reciben peores valoraciones en $B$ que en $A$ de forma inesperada.

Una cuestión interesante a destacar es que en general el análisis de las predicciones del modelo ordinal es más parsimonioso y estable que el análisis de las frecuencias relativas. Esto se va claramente en los ítems $Q01$, $Q07$ y $Q08$ en los que los estudiantes se muestran divididos y han evitado la contestación neutral y preferido los valores extremos. El modelo ha corregido esto y hecho unas predicciones más equilibradas.


```{=tex}

\begin{figure}[h]
\begin{adjustwidth}{-3.4cm}{}

\includegraphics[width=1.2\linewidth]{images/bayes-probs.png} \hfill{}

\caption{\label{fig-prob-compare}Comparación de las respuestas generadas
por el modelo y las frecuencias relativas de los datos.}

\end{adjustwidth}
\end{figure}

```


Para entender la explicación de la valoración de los alumnos en los ítems que tienen una respuesta no deseada se han analizado los comentarios que dejaron
^[Estos comentarios no se separaron en la fase de preprocesado y no se han utilizado ni consultado hasta la realización de este capítulo.]. La siguiente es una selección de comentarios:

* $Q14$ `r tolower(question_labels[14])`: `r paste((comments_df %>% filter(Item == "14" & Comment != "Sin comentario." & Row %in% c(76,23,110,14)) %>%  arrange(Group, Response))$Comment, collapse=" / ")`. Parece claro que algunos estudiantes no entendieron que la pregunta se refiere únicamente a si la fuente tipográfica es adecuada y contestan otras cuestiones.


  


# Conclusión y trabajo futuro {#sec-conclusion}

