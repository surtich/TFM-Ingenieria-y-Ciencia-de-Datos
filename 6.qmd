```{r}
source("_setup.R")
```

# Discusión y conclusiones {#sec-conclusiones}

## Modelado

La probabilidad de que los alumnos puntúen mejor el subtitulado $A$ que el $B$ frente a que lo puntúen igual o peor se estima que es del `r paste(round(100/(1+exp(-fixef(glmer_improve_subject_question)[[1]])),2),"%", sep="")`. Sin embargo, la distribución por ítems no es uniforme (ver @tbl-improve-question). Así, hay ítems en que esta probabilidad sobrepasa el 80% (`r paste((improve_question %>% filter(Prob > .8) %>% arrange(desc(Prob)))$Item, collapse=", ")`). Sin embargo hay otros en que no supera el 25% (`r paste((improve_question %>% filter(Prob < .25) %>% arrange(Prob))$Item, collapse=", ")`). La respuesta al ítem Q18 está por encima de la media (`r paste(round((improve_question %>% filter(Item=="Q18"))$Pro * 100, 2), "%", sep="")`). Parece claro que los ítems en los que la respuesta de los estudiantes es diferente en los dos subtitulados es porque aprecian diferencias reales entre ellos. Quedaría por dilucidar si en los ítems en los que no hay diferencia en las respuestas, se debe a que realmente no las hay o si es que los estudiantes no son capaces de detectarlas.

La magnitud del efecto del subtitulado sobre las valoraciones es muy superior a la de los efectos periodo y secuencia (ver @tbl-model-comp), por lo que se pueden realizar interpretaciones del modelo sin que nos deba preocupar su existencia. 

\scriptsize
```{r}
#| eval: true
#| cache: true
#|
set.seed(100)
df_prob_data <- df_clean %>%
    dplyr::select(Subject, Period, Seq, Treat, Response, Item) %>%
    arrange(Treat, Item, Response) %>%
    group_by(Treat, Item, Response, .drop = F) %>%
    summarize(n = n()) %>%
    ungroup(Response) %>%
    mutate(acc = cumsum(n), `Prob_data` = n / last(acc)) %>%
    pivot_wider(
        id_cols = c(Treat, Item),
        names_from = c(Response),
        values_from = c(Prob_data),
        names_glue = "{Response}_{.value}"
    )

df_prob_model <- epred_draws(brm_treat.period.subject.item, expand.grid(list(Period = c(1, 2), Treat = levels(df_clean$Treat), Item = levels(df_clean$Item))), re_formula = ~ (1 + Treat | Item)) %>%
    group_by(Treat, Item, .category) %>%
    summarize(q10 = quantile(.epred, probs = 0.1), q50 = quantile(.epred, probs = 0.5), q90 = quantile(.epred, probs = 0.9)) %>%
    ungroup() %>%
    pivot_wider(
        names_from = c(.category),
        values_from = c(q10, q50, q90),
        names_glue = "{.category}_{.value}"
    )

g <- inner_join(df_prob_data, df_prob_model) %>%
    pivot_wider(id_cols = Item, names_from = Treat, values_from = starts_with(paste(1:5))) %>%
    dplyr::select(Item, ends_with("A"), ends_with("B")) %>%
    ungroup() %>%
    gt() %>%
    fmt_number(columns = contains("_q"), decimals = 1, scale = 100) %>%
    fmt_percent(columns = contains("_data"), decimals = 1) %>%
    cols_merge(columns = c("1_q10_A", "1_q50_A", "1_q90_A"), pattern = "{2}% <br> <span style='font-size: 10px;'>({1}-{3})</span>") %>%
    cols_merge(columns = c("2_q10_A", "2_q50_A", "2_q90_A"), pattern = "{2}% <br> <span style='font-size: 10px;'>({1}-{3})</span>") %>%
    cols_merge(columns = c("3_q10_A", "3_q50_A", "3_q90_A"), pattern = "{2}% <br> <span style='font-size: 10px;'>({1}-{3})</span>") %>%
    cols_merge(columns = c("4_q10_A", "4_q50_A", "4_q90_A"), pattern = "{2}% <br> <span style='font-size: 10px;'>({1}-{3})</span>") %>%
    cols_merge(columns = c("5_q10_A", "5_q50_A", "5_q90_A"), pattern = "{2}% <br> <span style='font-size: 10px;'>({1}-{3})</span>") %>%
    cols_merge(columns = c("1_q10_B", "1_q50_B", "1_q90_B"), pattern = "{2}% <br> <span style='font-size: 10px;'>({1}-{3})</span>") %>%
    cols_merge(columns = c("2_q10_B", "2_q50_B", "2_q90_B"), pattern = "{2}% <br> <span style='font-size: 10px;'>({1}-{3})</span>") %>%
    cols_merge(columns = c("3_q10_B", "3_q50_B", "3_q90_B"), pattern = "{2}% <br> <span style='font-size: 10px;'>({1}-{3})</span>") %>%
    cols_merge(columns = c("4_q10_B", "4_q50_B", "4_q90_B"), pattern = "{2}% <br> <span style='font-size: 10px;'>({1}-{3})</span>") %>%
    cols_merge(columns = c("5_q10_B", "5_q50_B", "5_q90_B"), pattern = "{2}% <br> <span style='font-size: 10px;'>({1}-{3})</span>") %>%
    cols_label_with(
        fn = function(x) substr(x, 1, 1), columns = matches("Prob|[1-5]")
    ) %>%
    tab_spanner(label = "Data Frequencies", ends_with("Prob_data_A"), level = 1, id = "data_A") %>%
    tab_spanner(label = html("<div style='display: flex; justify-content: space-evenly; align-items: center; width: 100%'><div>Model Prob. Quantiles</div><div>50%</div><div style='font-size: 10px'>(10%, 90%)</div></div>"), ends_with("_q10_A"), level = 1, id = "model_A") %>%
    tab_spanner(label = "Data Frequencies", ends_with("Prob_data_B"), level = 1, id = "data_B") %>%
    tab_spanner(label = html("<div style='display: flex; justify-content: space-evenly; align-items: center; width: 100%'><div>Model Prob. Quantiles</div><div>50%</div><div style='font-size: 10px'>(10%, 90%)</div></div>"), ends_with("_q10_B"), level = 1, id = "model_B") %>%
    tab_spanner(label = "Treat A", ends_with("_A"), level = 2) %>%
    tab_spanner(label = "Treat B", ends_with("_B"), level = 2) %>%
    data_color(method = "numeric", columns = ends_with("A"), palette = "ggsci::blue_material", direction = "row") %>%
    data_color(method = "numeric", columns = ends_with("B"), palette = "ggsci::orange_material", direction = "row") %>%
    cols_align(align = "center", columns = everything())

gtsave(g, "images/bayes-probs.png", vwidth = 1500)

# g %>% as_raw_html()
```
\normalsize

```{=tex}

\begin{figure}[h]
\begin{adjustwidth}{-3.4cm}{}

\includegraphics[width=1.2\linewidth]{images/bayes-probs.png} \hfill{}

\caption{\label{fig-prob-compare}Comparación de las respuestas generadas
por el modelo y las frecuencias relativas de los datos.}

\end{adjustwidth}
\end{figure}

```


# Ciego

En esta sección se discuten los resultados una vez descubierto el ciego. Se confirma que el subtitulado del vídeo que se ha denominado como $A$ es el que está correctamente subtitulado y el $B$ es el vídeo en el que se han introducido errores en los subtítulos. En la \ref{tbl-blind-errors} se muestran los errores introduci,dos y los ítems de la escala de Likert en los que se ha valorado el error (ver @tbl-likert-scale para la descripción textual de cada ítem).

```{r}
q.errors <- c("Q02", "Q05", "Q06", "Q07", "Q08", "Q09", "Q10", "Q11", "Q12", "Q18")
q.no.errors <- setdiff(levels(df_clean$Item), q.errors)
```

```{=tex}
\begin{table}[H]
\caption{\label{tbl-blind-errors}Errores introducidos en el subtitulado.}\tabularnewline
\tiny
\begin{adjustwidth}{-2.5cm}{}
\begin{tabular}{@{}|c|l|l|l|@{}}
\toprule
\multicolumn{1}{|l|}{\textbf{Error nº}} &
  \textbf{Subtítulo} &
  \textbf{Requisito que se incumple} &
  \textbf{Ítems} \\ \midrule
1 &
  \begin{tabular}[c]{@{}l@{}}Correcto:\\ Hola, este vídeo nos va a servir\\ \\ Incorrecto:\\ Hola este video nos ba a servir\end{tabular} &
  \begin{tabular}[c]{@{}l@{}}Los subtítulos deben ser correctos\\ ortográfica y gramaticalmente.\end{tabular} &
  Q05 \\ \midrule
2 &
  \begin{tabular}[c]{@{}l@{}}Correcto: para hacer una práctica de subtitulado\\ \\ Incorrecto: para hacer una prácti\\ ca de subtitulado\end{tabular} &
  \begin{tabular}[c]{@{}l@{}}No se deben separar en dos líneas\\ las sílabas de la misma palabra.\end{tabular} &
   \\ \midrule
3 &
   &
  \begin{tabular}[c]{@{}l@{}}Los subtítulos deben ocupar\\ dos líneas y, excepcionalmente tres.\end{tabular} &
  Q02 \\ \midrule
4 &
   &
  \begin{tabular}[c]{@{}l@{}}Las conjunciones y los nexos\\ deben ir en la línea inferior.\end{tabular} &
  Q14 \\ \midrule
5 &
  \begin{tabular}[c]{@{}l@{}}Incorrecto: El texto del subtítulo es válido,\\ pero su entrada debe producirse antes para que\\ coincida con la información sonora.\end{tabular} &
  \begin{tabular}[c]{@{}l@{}}Las entradas y salidas de los subtítulos\\ deben coincidir con el movimiento labial,\\ con la locución y/o con la información sonora.\end{tabular} &
  Q10, Q09 \\ \midrule
6 &
  \begin{tabular}[c]{@{}l@{}}Correcto: (Teléfono) Perdonad\\ \\ Incorrecto: Perdonad\end{tabular} &
  \begin{tabular}[c]{@{}l@{}}Deben describirse los efectos sonoros\\ que sean relevantes para la comprensión del vídeo.\end{tabular} &
  Q09 \\ \midrule
7 &
  \begin{tabular}[c]{@{}l@{}}Correcto: ¿Dígame? \\ (EMI) Hola, soy Emilio.\\ \\ Incorrecto: ¿Dígame? (EMI) Hola, soy Emilio.\end{tabular} &
  \begin{tabular}[c]{@{}l@{}}Para cada participante en el diálogo\\ debe comenzarse una nueva línea.\end{tabular} &
  Q08 \\ \midrule
8 &
  \begin{tabular}[c]{@{}l@{}}Correcto:\\ (ALE) Emilio, muy buenas. Mira,\\ precisamente estoy grabando el vídeo\\ \\ Incorrecto:\\ (ALE) Emilio, muy buenas. Mira, precisamente estoy grabando el vídeo\end{tabular} &
  \begin{tabular}[c]{@{}l@{}}El máximo número de caracteres\\ por línea es 37.\end{tabular} &
  Q12 \\ \midrule
9 &
  \begin{tabular}[c]{@{}l@{}}Incorrecto: El texto del subtítulo es válido,\\ pero su duración debe ser de al menos 3 segundos.\end{tabular} &
  \begin{tabular}[c]{@{}l@{}}La velocidad de exposición del subtítulo\\ debe permitir leerlo sin dificultad.\\ La velocidad recomendada para los subtítulos\\ es de unos 12 caracteres por segundo.\end{tabular} &
  Q11 \\ \midrule
10 &
  \begin{tabular}[c]{@{}l@{}}Correcto: Luego voy a verte al despacho ¿de acuerdo?\\ \\ Incorrecto: Luego voy a verte al despacho ¿Ok?\end{tabular} &
  Los subtítulos deben ser literales. &
  Q06 \\ \midrule
11 &
  \begin{tabular}[c]{@{}l@{}}Correcto: (EMI) Muy bien, estupendo. Aquí estaré. \\ (ALE) Hasta luego\\ \\ Incorrecto: Muy bien, estupendo. Aquí estaré. \\ Hasta luego\end{tabular} &
  \begin{tabular}[c]{@{}l@{}}Los diferentes personajes que intervienen en la\\ obra audiovisual deben estar claramente identificados.\end{tabular} &
  Q07 \\ \bottomrule
\end{tabular}
\end{adjustwidth}
\normalsize
\end{table}
```

# Conclusión y trabajo futuro {#sec-conclusion}
#
